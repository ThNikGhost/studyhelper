# –ü–ª–∞–Ω: –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–∞ production —Å–∞–π—Ç–µ (http://89.110.93.63) –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
**–°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** Production –¥–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω, –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω.

## Phase 1: Initial Understanding - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (Explore –∞–≥–µ–Ω—Ç—ã)

#### ‚úÖ Backend/–ë–î —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∞–≥–µ–Ω—Ç a01dfe0):
- **3088 –∑–∞–ø–∏—Å–µ–π** –≤ —Ç–∞–±–ª–∏—Ü–µ `schedule_entries` (–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ 2026-02-09)
- **Snapshot —Å–æ–∑–¥–∞–Ω**: hash `9556f61c...`, 3088 entries
- **–î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç**: –Ω–æ—è–±—Ä—å 2025 ‚Äî –º–∞—Ä—Ç 2026
- **API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç**:
  - `GET /api/v1/schedule/today` ‚Üí 200 OK
  - `GET /api/v1/schedule/week` ‚Üí 200 OK
  - `GET /api/v1/schedule/current` ‚Üí 200 OK
- **–ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- **IP 81.23.207.45** —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–ª–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç)

#### ‚úÖ Frontend –∫–æ–¥ (–∞–≥–µ–Ω—Ç a8fc346):
- **SchedulePage** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /schedule/week` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `target_date`
- **Query key**: `['schedule', 'week', targetDate]`
- **Empty state**: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –Ω–µ—Ç –∑–∞–Ω—è—Ç–∏–π" –µ—Å–ª–∏ –≤—Å–µ –¥–Ω–∏ –ø—É—Å—Ç—ã–µ
- **Error state**: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è" + retry
- **Loading state**: skeleton —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
- **Refresh button**: –≤—ã–∑—ã–≤–∞–µ—Ç `POST /schedule/refresh?force=false`

### üéØ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!** Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –ë–î –∑–∞–ø–æ–ª–Ω–µ–Ω–∞, API endpoints –æ—Ç–≤–µ—á–∞—é—Ç 200 OK.

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

**–°—Ç–∞—Ç—É—Å:** –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞ —Å–∞–π—Ç–µ.

**–í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- **–ö–µ—à –±—Ä–∞—É–∑–µ—Ä–∞** ‚Äî –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Ctrl+F5) –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è frontend
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è, API —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- **–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã** ‚Äî –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ã–ª–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ –ë–î (3088 –∑–∞–ø–∏—Å–µ–π)

## Phase 2-4: –î–µ–π—Å—Ç–≤–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –¥–∞–Ω–Ω—ã–µ –≤ –ë–î –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (P0)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ë–î –±—ã–ª–∞ –ø—É—Å—Ç–∞—è, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é.

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron job –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.

#### –í–∞—Ä–∏–∞–Ω—Ç 1: Cron –≤ host —Å–∏—Å—Ç–µ–º–µ
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
0 */6 * * * docker exec studyhelper-backend python -m src.cli.schedule_cli sync >> /var/log/studyhelper-schedule-sync.log 2>&1
```
- –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤ (—Å–æ–≥–ª–∞—Å–Ω–æ `schedule_update_interval_hours` –≤ –∫–æ–Ω—Ñ–∏–≥–µ)
- –õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/var/log/studyhelper-schedule-sync.log`

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—á–µ—Ä–µ–∑ supercronic)
–î–æ–±–∞–≤–∏—Ç—å –≤ `backend/Dockerfile`:
```dockerfile
# Install supercronic
RUN wget -O /usr/local/bin/supercronic \
    https://github.com/aptible/supercronic/releases/download/v0.2.29/supercronic-linux-amd64 && \
    chmod +x /usr/local/bin/supercronic

# Add crontab
COPY crontab /etc/crontab
```

–°–æ–∑–¥–∞—Ç—å `backend/crontab`:
```
0 */6 * * * python -m src.cli.schedule_cli sync
```

–û–±–Ω–æ–≤–∏—Ç—å `entrypoint.sh`:
```bash
# Start cron in background
supercronic /etc/crontab &

# Start uvicorn
exec uvicorn src.main:app --host 0.0.0.0 --port 8000 --proxy-headers
```

### 2. API endpoint –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≥–æ—Ç–æ–≤–æ)

**–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** `POST /api/v1/schedule/refresh`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ frontend:**
- –ö–Ω–æ–ø–∫–∞ "–û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ" –Ω–∞ SchedulePage
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –ü–∞—Ä–∞–º–µ—Ç—Ä `force=true` ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å

### 3. –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å `schedule_cli sync`.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤ `entrypoint.sh` –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç:

```bash
#!/bin/sh
set -e

# Wait for PostgreSQL
echo "Waiting for PostgreSQL..."
while ! nc -z db 5432; do sleep 1; done
echo "PostgreSQL is ready!"

# Run migrations
echo "Running Alembic migrations..."
alembic upgrade head
echo "Migrations complete!"

# Check if schedule is empty and import if needed
ENTRY_COUNT=$(python -c "
from sqlalchemy import create_engine, text
from src.config import settings
engine = create_engine(settings.database_url.replace('+asyncpg', ''))
with engine.connect() as conn:
    result = conn.execute(text('SELECT COUNT(*) FROM schedule_entries'))
    print(result.scalar())
")

if [ "$ENTRY_COUNT" -eq "0" ]; then
    echo "Schedule is empty, importing initial data..."
    python -m src.cli.schedule_cli sync
    echo "Initial schedule imported!"
fi

# Start uvicorn
echo "Starting uvicorn..."
exec uvicorn src.main:app --host 0.0.0.0 --port 8000 --proxy-headers
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏:**
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É–¥–∞—á–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (email/Telegram)
- –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é snapshots –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:**
```
2026-02-09 12:00:00 - INFO - Schedule sync started
2026-02-09 12:00:05 - INFO - Fetched 3088 entries from OmSU API
2026-02-09 12:00:06 - INFO - Content unchanged (hash: 9556f61c...)
2026-02-09 12:00:06 - INFO - Schedule sync completed
```

## –ò—Ç–æ–≥–æ–≤—ã–π –ø–ª–∞–Ω

### ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å
- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ
- 3088 –∑–∞–ø–∏—Å–µ–π –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ –ë–î
- API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- Frontend –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

### üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P0 (–∫—Ä–∏—Ç–∏—á–Ω–æ):**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (cron –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤)
2. –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–∏—á–Ω—ã–π –∏–º–ø–æ—Ä—Ç –≤ `entrypoint.sh`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç P2 (—É–ª—É—á—à–µ–Ω–∏—è):**
5. –ò–∑–≤–ª–µ—á—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ subjects/teachers –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
6. –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
